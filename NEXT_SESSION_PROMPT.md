# 新会话任务提示：继续 Task 6.3 - 实现低清算罚金机制

## 📋 当前项目状态

### ✅ 已完成的任务
- **Task 6.1**: 在 BorrowingPool 中实现 Tick 清算 ✅ **已完成**
- **Task 6.2**: 实现部分清算逻辑 ✅ **已完成**

### 🎯 下一个任务：Task 6.3 - 实现低清算罚金机制

## 📖 任务详情

### Task 6.3 目标
实现低至0.1%的清算罚金机制，包括：
- 实现低至0.1%的清算罚金设置
- 实现基于资产类型和市场条件的动态罚金
- 实现清算罚金在清算者和平台间的分配
- 实现清算奖励的计算和分发

### 相关需求
- _需求: 6.17, 6.18, 6.19, 6.36, 6.37, 6.38_

## 🔧 技术背景

### 现有清算系统状态
1. **Tick 清算机制**（Task 6.1）：
   - 按抵押率区间分组的 Tick 清算
   - 动态 Tick 大小调整（0.1%-0.5%）
   - 批量清算处理

2. **部分清算逻辑**（Task 6.2）：
   - 多轮部分清算支持
   - 智能停止条件
   - 自适应清算策略
   - 清算效率优化

### 当前清算配置
- 默认清算罚金：0.1%（10 basis points）
- 默认清算奖励：0.05%（5 basis points）
- 最大清算比例：10%（1000 basis points）
- Tick 大小：0.5%（50 basis points）

## 🎯 Task 6.3 实现重点

### 1. 动态罚金机制
- 基于资产类型的罚金调整
- 基于市场波动性的动态罚金
- 基于清算紧急程度的罚金调整
- 最低0.1%罚金保障

### 2. 罚金分配机制
- 清算者奖励分配
- 平台收益分配
- 保险基金分配
- 用户损失最小化

### 3. 奖励计算优化
- 清算奖励与罚金的关系
- 清算者激励机制
- 风险调整奖励
- 批量清算奖励优化

### 4. 市场条件适应
- 价格波动性检测
- 流动性状况评估
- 市场压力指标
- 动态参数调整

## 📁 关键文件位置

### 主要实现文件
- `sources/borrowing_pool.move` - 主要清算逻辑
- `sources/oracle.move` - 价格数据和市场条件
- `sources/vault.move` - 资产管理
- `sources/constants.move` - 常量定义
- `sources/errors.move` - 错误处理

### 测试文件
- `tests/test_borrowing_pool.move` - 清算系统测试
- 需要添加低罚金机制的专门测试

### 配置文件
- `.kiro/specs/olend-defi-platform/tasks.md` - 任务列表
- `.kiro/specs/olend-defi-platform/requirements.md` - 需求文档
- `.kiro/specs/olend-defi-platform/design.md` - 设计文档

## 🔍 现有清算函数

### 核心清算函数
```move
// 单轮清算
public fun liquidate_position<T, C>(...)

// 多轮清算
public fun liquidate_position_multi_round<T, C>(...)

// 自适应清算
public fun liquidate_position_adaptive<T, C>(...)

// 批量清算
public fun batch_liquidate_tick_simple<T, C>(...)
```

### 配置管理函数
```move
// 更新清算配置
public fun update_liquidation_config<T>(...)

// 获取清算配置
public fun get_liquidation_config<T>(...): (u64, u64, u64, u64)

// 获取清算统计
public fun get_liquidation_stats<T>(...): (u64, u64, u64, u64)
```

## 🎯 实现策略

### 阶段1：动态罚金计算
1. 实现资产类型罚金映射
2. 实现市场波动性检测
3. 实现动态罚金计算函数
4. 集成到现有清算流程

### 阶段2：罚金分配机制
1. 实现多方分配逻辑
2. 实现分配比例配置
3. 实现分配执行函数
4. 添加分配事件追踪

### 阶段3：奖励优化
1. 优化清算者奖励计算
2. 实现风险调整机制
3. 实现批量清算奖励
4. 集成激励机制

### 阶段4：测试和验证
1. 编写单元测试
2. 集成测试
3. 边界条件测试
4. 性能测试

## 📊 成功指标

### 功能指标
- ✅ 支持低至0.1%的清算罚金
- ✅ 动态罚金根据市场条件调整
- ✅ 清算罚金合理分配给各方
- ✅ 清算奖励计算准确

### 技术指标
- ✅ 所有新函数编译通过
- ✅ 与现有清算系统集成
- ✅ 测试覆盖率达到90%+
- ✅ 性能无明显下降

### 业务指标
- ✅ 用户清算损失最小化
- ✅ 清算者激励充分
- ✅ 平台收益合理
- ✅ 系统风险可控

## 🚀 开始指令

请继续执行 **Task 6.3: 实现低清算罚金机制**，重点关注：

1. **动态罚金机制**：实现基于资产类型和市场条件的动态罚金调整
2. **分配机制**：实现清算罚金在清算者、平台和保险基金间的合理分配
3. **奖励优化**：优化清算奖励计算，确保清算者有足够激励
4. **系统集成**：与现有的 Tick 清算和部分清算逻辑无缝集成

开始实现时，请先：
1. 检查当前 `sources/borrowing_pool.move` 中的清算配置结构
2. 分析现有的罚金和奖励计算逻辑
3. 设计动态罚金调整算法
4. 实现分配机制的数据结构和函数

让我们继续构建这个高效、用户友好的清算系统！🎯